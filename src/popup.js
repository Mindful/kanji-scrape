//jouyou kanji scraped from http://en.wikipedia.org/wiki/List_of_j%C5%8Dy%C5%8D_kanji
//using $('.sortable > tbody > tr :nth-child(2) .extiw')

var JOUYOU_KANJI = {"亜":true,"哀":true,"挨":true,"愛":true,"曖":true,"悪":true,"握":true,"圧":true,"扱":true,"宛":true,"嵐":true,"安":true,"案":true,"暗":true,"以":true,"衣":true,"位":true,"囲":true,"医":true,"依":true,"委":true,"威":true,"為":true,"畏":true,"胃":true,"尉":true,"異":true,"移":true,"萎":true,"偉":true,"椅":true,"彙":true,"意":true,"違":true,"維":true,"慰":true,"遺":true,"緯":true,"域":true,"育":true,"一":true,"壱":true,"逸":true,"茨":true,"芋":true,"引":true,"印":true,"因":true,"咽":true,"姻":true,"員":true,"院":true,"淫":true,"陰":true,"飲":true,"隠":true,"韻":true,"右":true,"宇":true,"羽":true,"雨":true,"唄":true,"鬱":true,"畝":true,"浦":true,"運":true,"雲":true,"永":true,"泳":true,"英":true,"映":true,"栄":true,"営":true,"詠":true,"影":true,"鋭":true,"衛":true,"易":true,"疫":true,"益":true,"液":true,"駅":true,"悦":true,"越":true,"謁":true,"閲":true,"円":true,"延":true,"沿":true,"炎":true,"怨":true,"宴":true,"媛":true,"援":true,"園":true,"煙":true,"猿":true,"遠":true,"鉛":true,"塩":true,"演":true,"縁":true,"艶":true,"汚":true,"王":true,"凹":true,"央":true,"応":true,"往":true,"押":true,"旺":true,"欧":true,"殴":true,"桜":true,"翁":true,"奥":true,"横":true,"岡":true,"屋":true,"億":true,"憶":true,"臆":true,"虞":true,"乙":true,"俺":true,"卸":true,"音":true,"恩":true,"温":true,"穏":true,"下":true,"化":true,"火":true,"加":true,"可":true,"仮":true,"何":true,"花":true,"佳":true,"価":true,"果":true,"河":true,"苛":true,"科":true,"架":true,"夏":true,"家":true,"荷":true,"華":true,"菓":true,"貨":true,"渦":true,"過":true,"嫁":true,"暇":true,"禍":true,"靴":true,"寡":true,"歌":true,"箇":true,"稼":true,"課":true,"蚊":true,"牙":true,"瓦":true,"我":true,"画":true,"芽":true,"賀":true,"雅":true,"餓":true,"介":true,"回":true,"灰":true,"会":true,"快":true,"戒":true,"改":true,"怪":true,"拐":true,"悔":true,"海":true,"界":true,"皆":true,"械":true,"絵":true,"開":true,"階":true,"塊":true,"楷":true,"解":true,"潰":true,"壊":true,"懐":true,"諧":true,"貝":true,"外":true,"劾":true,"害":true,"崖":true,"涯":true,"街":true,"慨":true,"蓋":true,"該":true,"概":true,"骸":true,"垣":true,"柿":true,"各":true,"角":true,"拡":true,"革":true,"格":true,"核":true,"殻":true,"郭":true,"覚":true,"較":true,"隔":true,"閣":true,"確":true,"獲":true,"嚇":true,"穫":true,"学":true,"岳":true,"楽":true,"額":true,"顎":true,"掛":true,"潟":true,"括":true,"活":true,"喝":true,"渇":true,"割":true,"葛":true,"滑":true,"褐":true,"轄":true,"且":true,"株":true,"釜":true,"鎌":true,"刈":true,"干":true,"刊":true,"甘":true,"汗":true,"缶":true,"完":true,"肝":true,"官":true,"冠":true,"巻":true,"看":true,"陥":true,"乾":true,"勘":true,"患":true,"貫":true,"寒":true,"喚":true,"堪":true,"換":true,"敢":true,"棺":true,"款":true,"間":true,"閑":true,"勧":true,"寛":true,"幹":true,"感":true,"漢":true,"慣":true,"管":true,"関":true,"歓":true,"監":true,"緩":true,"憾":true,"還":true,"館":true,"環":true,"簡":true,"観":true,"韓":true,"艦":true,"鑑":true,"丸":true,"含":true,"岸":true,"岩":true,"玩":true,"眼":true,"頑":true,"顔":true,"願":true,"企":true,"伎":true,"危":true,"机":true,"気":true,"岐":true,"希":true,"忌":true,"汽":true,"奇":true,"祈":true,"季":true,"紀":true,"軌":true,"既":true,"記":true,"起":true,"飢":true,"鬼":true,"帰":true,"基":true,"寄":true,"規":true,"亀":true,"喜":true,"幾":true,"揮":true,"期":true,"棋":true,"貴":true,"棄":true,"毀":true,"旗":true,"器":true,"畿":true,"輝":true,"機":true,"騎":true,"技":true,"宜":true,"偽":true,"欺":true,"義":true,"疑":true,"儀":true,"戯":true,"擬":true,"犠":true,"議":true,"菊":true,"吉":true,"喫":true,"詰":true,"却":true,"客":true,"脚":true,"逆":true,"虐":true,"九":true,"久":true,"及":true,"弓":true,"丘":true,"旧":true,"休":true,"吸":true,"朽":true,"臼":true,"求":true,"究":true,"泣":true,"急":true,"級":true,"糾":true,"宮":true,"救":true,"球":true,"給":true,"嗅":true,"窮":true,"牛":true,"去":true,"巨":true,"居":true,"拒":true,"拠":true,"挙":true,"虚":true,"許":true,"距":true,"魚":true,"御":true,"漁":true,"凶":true,"共":true,"叫":true,"狂":true,"京":true,"享":true,"供":true,"協":true,"況":true,"峡":true,"挟":true,"狭":true,"恐":true,"恭":true,"胸":true,"脅":true,"強":true,"教":true,"郷":true,"境":true,"橋":true,"矯":true,"鏡":true,"競":true,"響":true,"驚":true,"仰":true,"暁":true,"業":true,"凝":true,"曲":true,"局":true,"極":true,"玉":true,"巾":true,"斤":true,"均":true,"近":true,"金":true,"菌":true,"勤":true,"琴":true,"筋":true,"僅":true,"禁":true,"緊":true,"錦":true,"謹":true,"襟":true,"吟":true,"銀":true,"区":true,"句":true,"苦":true,"駆":true,"具":true,"惧":true,"愚":true,"空":true,"偶":true,"遇":true,"隅":true,"串":true,"屈":true,"掘":true,"窟":true,"熊":true,"繰":true,"君":true,"訓":true,"勲":true,"薫":true,"軍":true,"郡":true,"群":true,"兄":true,"刑":true,"形":true,"系":true,"径":true,"茎":true,"係":true,"型":true,"契":true,"計":true,"恵":true,"啓":true,"掲":true,"渓":true,"経":true,"蛍":true,"敬":true,"景":true,"軽":true,"傾":true,"携":true,"継":true,"詣":true,"慶":true,"憬":true,"稽":true,"憩":true,"警":true,"鶏":true,"芸":true,"迎":true,"鯨":true,"隙":true,"劇":true,"撃":true,"激":true,"桁":true,"欠":true,"穴":true,"血":true,"決":true,"結":true,"傑":true,"潔":true,"月":true,"犬":true,"件":true,"見":true,"券":true,"肩":true,"建":true,"研":true,"県":true,"倹":true,"兼":true,"剣":true,"拳":true,"軒":true,"健":true,"険":true,"圏":true,"堅":true,"検":true,"嫌":true,"献":true,"絹":true,"遣":true,"権":true,"憲":true,"賢":true,"謙":true,"鍵":true,"繭":true,"顕":true,"験":true,"懸":true,"元":true,"幻":true,"玄":true,"言":true,"弦":true,"限":true,"原":true,"現":true,"舷":true,"減":true,"源":true,"厳":true,"己":true,"戸":true,"古":true,"呼":true,"固":true,"股":true,"虎":true,"孤":true,"弧":true,"故":true,"枯":true,"個":true,"庫":true,"湖":true,"雇":true,"誇":true,"鼓":true,"錮":true,"顧":true,"五":true,"互":true,"午":true,"呉":true,"後":true,"娯":true,"悟":true,"碁":true,"語":true,"誤":true,"護":true,"口":true,"工":true,"公":true,"勾":true,"孔":true,"功":true,"巧":true,"広":true,"甲":true,"交":true,"光":true,"向":true,"后":true,"好":true,"江":true,"考":true,"行":true,"坑":true,"孝":true,"抗":true,"攻":true,"更":true,"効":true,"幸":true,"拘":true,"肯":true,"侯":true,"厚":true,"恒":true,"洪":true,"皇":true,"紅":true,"荒":true,"郊":true,"香":true,"候":true,"校":true,"耕":true,"航":true,"貢":true,"降":true,"高":true,"康":true,"控":true,"梗":true,"黄":true,"喉":true,"慌":true,"港":true,"硬":true,"絞":true,"項":true,"溝":true,"鉱":true,"構":true,"綱":true,"酵":true,"稿":true,"興":true,"衡":true,"鋼":true,"講":true,"購":true,"乞":true,"号":true,"合":true,"拷":true,"剛":true,"傲":true,"豪":true,"克":true,"告":true,"谷":true,"刻":true,"国":true,"黒":true,"穀":true,"酷":true,"獄":true,"骨":true,"駒":true,"込":true,"頃":true,"今":true,"困":true,"昆":true,"恨":true,"根":true,"婚":true,"混":true,"痕":true,"紺":true,"魂":true,"墾":true,"懇":true,"左":true,"佐":true,"沙":true,"査":true,"砂":true,"唆":true,"差":true,"詐":true,"鎖":true,"座":true,"挫":true,"才":true,"再":true,"災":true,"妻":true,"采":true,"砕":true,"宰":true,"栽":true,"彩":true,"採":true,"済":true,"祭":true,"斎":true,"細":true,"菜":true,"最":true,"裁":true,"債":true,"催":true,"塞":true,"歳":true,"載":true,"際":true,"埼":true,"在":true,"材":true,"剤":true,"財":true,"罪":true,"崎":true,"作":true,"削":true,"昨":true,"柵":true,"索":true,"策":true,"酢":true,"搾":true,"錯":true,"咲":true,"冊":true,"札":true,"刷":true,"刹":true,"拶":true,"殺":true,"察":true,"撮":true,"擦":true,"雑":true,"皿":true,"三":true,"山":true,"参":true,"桟":true,"蚕":true,"惨":true,"産":true,"傘":true,"散":true,"算":true,"酸":true,"賛":true,"残":true,"斬":true,"暫":true,"士":true,"子":true,"支":true,"止":true,"氏":true,"仕":true,"史":true,"司":true,"四":true,"市":true,"矢":true,"旨":true,"死":true,"糸":true,"至":true,"伺":true,"志":true,"私":true,"使":true,"刺":true,"始":true,"姉":true,"枝":true,"祉":true,"肢":true,"姿":true,"思":true,"指":true,"施":true,"師":true,"恣":true,"紙":true,"脂":true,"視":true,"紫":true,"詞":true,"歯":true,"嗣":true,"試":true,"詩":true,"資":true,"飼":true,"誌":true,"雌":true,"摯":true,"賜":true,"諮":true,"示":true,"字":true,"寺":true,"次":true,"耳":true,"自":true,"似":true,"児":true,"事":true,"侍":true,"治":true,"持":true,"時":true,"滋":true,"慈":true,"辞":true,"磁":true,"餌":true,"璽":true,"鹿":true,"式":true,"識":true,"軸":true,"七":true,"𠮟":true,"失":true,"室":true,"疾":true,"執":true,"湿":true,"嫉":true,"漆":true,"質":true,"実":true,"芝":true,"写":true,"社":true,"車":true,"舎":true,"者":true,"射":true,"捨":true,"赦":true,"斜":true,"煮":true,"遮":true,"謝":true,"邪":true,"蛇":true,"尺":true,"借":true,"酌":true,"釈":true,"爵":true,"若":true,"弱":true,"寂":true,"手":true,"主":true,"守":true,"朱":true,"取":true,"狩":true,"首":true,"殊":true,"珠":true,"酒":true,"腫":true,"種":true,"趣":true,"寿":true,"受":true,"呪":true,"授":true,"需":true,"儒":true,"樹":true,"収":true,"囚":true,"州":true,"舟":true,"秀":true,"周":true,"宗":true,"拾":true,"秋":true,"臭":true,"修":true,"袖":true,"終":true,"羞":true,"習":true,"週":true,"就":true,"衆":true,"集":true,"愁":true,"酬":true,"醜":true,"蹴":true,"襲":true,"十":true,"汁":true,"充":true,"住":true,"柔":true,"重":true,"従":true,"渋":true,"銃":true,"獣":true,"縦":true,"叔":true,"祝":true,"宿":true,"淑":true,"粛":true,"縮":true,"塾":true,"熟":true,"出":true,"述":true,"術":true,"俊":true,"春":true,"瞬":true,"旬":true,"巡":true,"盾":true,"准":true,"殉":true,"純":true,"循":true,"順":true,"準":true,"潤":true,"遵":true,"処":true,"初":true,"所":true,"書":true,"庶":true,"暑":true,"署":true,"緒":true,"諸":true,"女":true,"如":true,"助":true,"序":true,"叙":true,"徐":true,"除":true,"小":true,"升":true,"少":true,"召":true,"匠":true,"床":true,"抄":true,"肖":true,"尚":true,"招":true,"承":true,"昇":true,"松":true,"沼":true,"昭":true,"宵":true,"将":true,"消":true,"症":true,"祥":true,"称":true,"笑":true,"唱":true,"商":true,"渉":true,"章":true,"紹":true,"訟":true,"勝":true,"掌":true,"晶":true,"焼":true,"焦":true,"硝":true,"粧":true,"詔":true,"証":true,"象":true,"傷":true,"奨":true,"照":true,"詳":true,"彰":true,"障":true,"憧":true,"衝":true,"賞":true,"償":true,"礁":true,"鐘":true,"上":true,"丈":true,"冗":true,"条":true,"状":true,"乗":true,"城":true,"浄":true,"剰":true,"常":true,"情":true,"場":true,"畳":true,"蒸":true,"縄":true,"壌":true,"嬢":true,"錠":true,"譲":true,"醸":true,"色":true,"拭":true,"食":true,"植":true,"殖":true,"飾":true,"触":true,"嘱":true,"織":true,"職":true,"辱":true,"尻":true,"心":true,"申":true,"伸":true,"臣":true,"芯":true,"身":true,"辛":true,"侵":true,"信":true,"津":true,"神":true,"唇":true,"娠":true,"振":true,"浸":true,"真":true,"針":true,"深":true,"紳":true,"進":true,"森":true,"診":true,"寝":true,"慎":true,"新":true,"審":true,"震":true,"薪":true,"親":true,"人":true,"刃":true,"仁":true,"尽":true,"迅":true,"甚":true,"陣":true,"尋":true,"腎":true,"須":true,"図":true,"水":true,"吹":true,"垂":true,"炊":true,"帥":true,"粋":true,"衰":true,"推":true,"酔":true,"遂":true,"睡":true,"穂":true,"随":true,"髄":true,"枢":true,"崇":true,"数":true,"据":true,"杉":true,"裾":true,"寸":true,"瀬":true,"是":true,"井":true,"世":true,"正":true,"生":true,"成":true,"西":true,"声":true,"制":true,"姓":true,"征":true,"性":true,"青":true,"斉":true,"政":true,"星":true,"牲":true,"省":true,"凄":true,"逝":true,"清":true,"盛":true,"婿":true,"晴":true,"勢":true,"聖":true,"誠":true,"精":true,"製":true,"誓":true,"静":true,"請":true,"整":true,"醒":true,"税":true,"夕":true,"斥":true,"石":true,"赤":true,"昔":true,"析":true,"席":true,"脊":true,"隻":true,"惜":true,"戚":true,"責":true,"跡":true,"積":true,"績":true,"籍":true,"切":true,"折":true,"拙":true,"窃":true,"接":true,"設":true,"雪":true,"摂":true,"節":true,"説":true,"舌":true,"絶":true,"千":true,"川":true,"仙":true,"占":true,"先":true,"宣":true,"専":true,"泉":true,"浅":true,"洗":true,"染":true,"扇":true,"栓":true,"旋":true,"船":true,"戦":true,"煎":true,"羨":true,"腺":true,"詮":true,"践":true,"箋":true,"銭":true,"潜":true,"線":true,"遷":true,"選":true,"薦":true,"繊":true,"鮮":true,"全":true,"前":true,"善":true,"然":true,"禅":true,"漸":true,"膳":true,"繕":true,"狙":true,"阻":true,"祖":true,"租":true,"素":true,"措":true,"粗":true,"組":true,"疎":true,"訴":true,"塑":true,"遡":true,"礎":true,"双":true,"壮":true,"早":true,"争":true,"走":true,"奏":true,"相":true,"荘":true,"草":true,"送":true,"倉":true,"捜":true,"挿":true,"桑":true,"巣":true,"掃":true,"曹":true,"曽":true,"爽":true,"窓":true,"創":true,"喪":true,"痩":true,"葬":true,"装":true,"僧":true,"想":true,"層":true,"総":true,"遭":true,"槽":true,"踪":true,"操":true,"燥":true,"霜":true,"騒":true,"藻":true,"造":true,"像":true,"増":true,"憎":true,"蔵":true,"贈":true,"臓":true,"即":true,"束":true,"足":true,"促":true,"則":true,"息":true,"捉":true,"速":true,"側":true,"測":true,"俗":true,"族":true,"属":true,"賊":true,"続":true,"卒":true,"率":true,"存":true,"村":true,"孫":true,"尊":true,"損":true,"遜":true,"他":true,"多":true,"汰":true,"打":true,"妥":true,"唾":true,"堕":true,"惰":true,"駄":true,"太":true,"対":true,"体":true,"耐":true,"待":true,"怠":true,"胎":true,"退":true,"帯":true,"泰":true,"堆":true,"袋":true,"逮":true,"替":true,"貸":true,"隊":true,"滞":true,"態":true,"戴":true,"大":true,"代":true,"台":true,"第":true,"題":true,"滝":true,"宅":true,"択":true,"沢":true,"卓":true,"拓":true,"託":true,"濯":true,"諾":true,"濁":true,"但":true,"達":true,"脱":true,"奪":true,"棚":true,"誰":true,"丹":true,"旦":true,"担":true,"単":true,"炭":true,"胆":true,"探":true,"淡":true,"短":true,"嘆":true,"端":true,"綻":true,"誕":true,"鍛":true,"団":true,"男":true,"段":true,"断":true,"弾":true,"暖":true,"談":true,"壇":true,"地":true,"池":true,"知":true,"値":true,"恥":true,"致":true,"遅":true,"痴":true,"稚":true,"置":true,"緻":true,"竹":true,"畜":true,"逐":true,"蓄":true,"築":true,"秩":true,"窒":true,"茶":true,"着":true,"嫡":true,"中":true,"仲":true,"虫":true,"沖":true,"宙":true,"忠":true,"抽":true,"注":true,"昼":true,"柱":true,"衷":true,"酎":true,"鋳":true,"駐":true,"著":true,"貯":true,"丁":true,"弔":true,"庁":true,"兆":true,"町":true,"長":true,"挑":true,"帳":true,"張":true,"彫":true,"眺":true,"釣":true,"頂":true,"鳥":true,"朝":true,"貼":true,"超":true,"腸":true,"跳":true,"徴":true,"嘲":true,"潮":true,"澄":true,"調":true,"聴":true,"懲":true,"直":true,"勅":true,"捗":true,"沈":true,"珍":true,"朕":true,"陳":true,"賃":true,"鎮":true,"追":true,"椎":true,"墜":true,"通":true,"痛":true,"塚":true,"漬":true,"坪":true,"爪":true,"鶴":true,"低":true,"呈":true,"廷":true,"弟":true,"定":true,"底":true,"抵":true,"邸":true,"亭":true,"貞":true,"帝":true,"訂":true,"庭":true,"逓":true,"停":true,"偵":true,"堤":true,"提":true,"程":true,"艇":true,"締":true,"諦":true,"泥":true,"的":true,"笛":true,"摘":true,"滴":true,"適":true,"敵":true,"溺":true,"迭":true,"哲":true,"鉄":true,"徹":true,"撤":true,"天":true,"典":true,"店":true,"点":true,"展":true,"添":true,"転":true,"塡":true,"田":true,"伝":true,"殿":true,"電":true,"斗":true,"吐":true,"妬":true,"徒":true,"途":true,"都":true,"渡":true,"塗":true,"賭":true,"土":true,"奴":true,"努":true,"度":true,"怒":true,"刀":true,"冬":true,"灯":true,"当":true,"投":true,"豆":true,"東":true,"到":true,"逃":true,"倒":true,"凍":true,"唐":true,"島":true,"桃":true,"討":true,"透":true,"党":true,"悼":true,"盗":true,"陶":true,"塔":true,"搭":true,"棟":true,"湯":true,"痘":true,"登":true,"答":true,"等":true,"筒":true,"統":true,"稲":true,"踏":true,"糖":true,"頭":true,"謄":true,"藤":true,"闘":true,"騰":true,"同":true,"洞":true,"胴":true,"動":true,"堂":true,"童":true,"道":true,"働":true,"銅":true,"導":true,"瞳":true,"峠":true,"匿":true,"特":true,"得":true,"督":true,"徳":true,"篤":true,"毒":true,"独":true,"読":true,"栃":true,"凸":true,"突":true,"届":true,"屯":true,"豚":true,"頓":true,"貪":true,"鈍":true,"曇":true,"丼":true,"那":true,"奈":true,"内":true,"梨":true,"謎":true,"鍋":true,"南":true,"軟":true,"難":true,"二":true,"尼":true,"弐":true,"匂":true,"肉":true,"虹":true,"日":true,"入":true,"乳":true,"尿":true,"任":true,"妊":true,"忍":true,"認":true,"寧":true,"熱":true,"年":true,"念":true,"捻":true,"粘":true,"燃":true,"悩":true,"納":true,"能":true,"脳":true,"農":true,"濃":true,"把":true,"波":true,"派":true,"破":true,"覇":true,"馬":true,"婆":true,"罵":true,"拝":true,"杯":true,"背":true,"肺":true,"俳":true,"配":true,"排":true,"敗":true,"廃":true,"輩":true,"売":true,"倍":true,"梅":true,"培":true,"陪":true,"媒":true,"買":true,"賠":true,"白":true,"伯":true,"拍":true,"泊":true,"迫":true,"剝":true,"舶":true,"博":true,"薄":true,"麦":true,"漠":true,"縛":true,"爆":true,"箱":true,"箸":true,"畑":true,"肌":true,"八":true,"鉢":true,"発":true,"髪":true,"伐":true,"抜":true,"罰":true,"閥":true,"反":true,"半":true,"氾":true,"犯":true,"帆":true,"汎":true,"伴":true,"判":true,"坂":true,"阪":true,"板":true,"版":true,"班":true,"畔":true,"般":true,"販":true,"斑":true,"飯":true,"搬":true,"煩":true,"頒":true,"範":true,"繁":true,"藩":true,"晩":true,"番":true,"蛮":true,"盤":true,"比":true,"皮":true,"妃":true,"否":true,"批":true,"彼":true,"披":true,"肥":true,"非":true,"卑":true,"飛":true,"疲":true,"秘":true,"被":true,"悲":true,"扉":true,"費":true,"碑":true,"罷":true,"避":true,"尾":true,"眉":true,"美":true,"備":true,"微":true,"鼻":true,"膝":true,"肘":true,"匹":true,"必":true,"泌":true,"筆":true,"姫":true,"百":true,"氷":true,"表":true,"俵":true,"票":true,"評":true,"漂":true,"標":true,"苗":true,"秒":true,"病":true,"描":true,"猫":true,"品":true,"浜":true,"貧":true,"賓":true,"頻":true,"敏":true,"瓶":true,"不":true,"夫":true,"父":true,"付":true,"布":true,"扶":true,"府":true,"怖":true,"阜":true,"附":true,"訃":true,"負":true,"赴":true,"浮":true,"婦":true,"符":true,"富":true,"普":true,"腐":true,"敷":true,"膚":true,"賦":true,"譜":true,"侮":true,"武":true,"部":true,"舞":true,"封":true,"風":true,"伏":true,"服":true,"副":true,"幅":true,"復":true,"福":true,"腹":true,"複":true,"覆":true,"払":true,"沸":true,"仏":true,"物":true,"粉":true,"紛":true,"雰":true,"噴":true,"墳":true,"憤":true,"奮":true,"分":true,"文":true,"聞":true,"丙":true,"平":true,"兵":true,"併":true,"並":true,"柄":true,"陛":true,"閉":true,"塀":true,"幣":true,"弊":true,"蔽":true,"餅":true,"米":true,"壁":true,"璧":true,"癖":true,"別":true,"蔑":true,"片":true,"辺":true,"返":true,"変":true,"偏":true,"遍":true,"編":true,"弁":true,"便":true,"勉":true,"歩":true,"保":true,"哺":true,"捕":true,"補":true,"舗":true,"母":true,"募":true,"墓":true,"慕":true,"暮":true,"簿":true,"方":true,"包":true,"芳":true,"邦":true,"奉":true,"宝":true,"抱":true,"放":true,"法":true,"泡":true,"胞":true,"俸":true,"倣":true,"峰":true,"砲":true,"崩":true,"訪":true,"報":true,"蜂":true,"豊":true,"飽":true,"褒":true,"縫":true,"亡":true,"乏":true,"忙":true,"坊":true,"妨":true,"忘":true,"防":true,"房":true,"肪":true,"某":true,"冒":true,"剖":true,"紡":true,"望":true,"傍":true,"帽":true,"棒":true,"貿":true,"貌":true,"暴":true,"膨":true,"謀":true,"頰":true,"北":true,"木":true,"朴":true,"牧":true,"睦":true,"僕":true,"墨":true,"撲":true,"没":true,"勃":true,"堀":true,"本":true,"奔":true,"翻":true,"凡":true,"盆":true,"麻":true,"摩":true,"磨":true,"魔":true,"毎":true,"妹":true,"枚":true,"昧":true,"埋":true,"幕":true,"膜":true,"枕":true,"又":true,"末":true,"抹":true,"万":true,"満":true,"慢":true,"漫":true,"未":true,"味":true,"魅":true,"岬":true,"密":true,"蜜":true,"脈":true,"妙":true,"民":true,"眠":true,"矛":true,"務":true,"無":true,"夢":true,"霧":true,"娘":true,"名":true,"命":true,"明":true,"迷":true,"冥":true,"盟":true,"銘":true,"鳴":true,"滅":true,"免":true,"面":true,"綿":true,"麺":true,"茂":true,"模":true,"毛":true,"妄":true,"盲":true,"耗":true,"猛":true,"網":true,"目":true,"黙":true,"門":true,"紋":true,"問":true,"冶":true,"夜":true,"野":true,"弥":true,"厄":true,"役":true,"約":true,"訳":true,"薬":true,"躍":true,"闇":true,"由":true,"油":true,"喩":true,"愉":true,"諭":true,"輸":true,"癒":true,"唯":true,"友":true,"有":true,"勇":true,"幽":true,"悠":true,"郵":true,"湧":true,"猶":true,"裕":true,"遊":true,"雄":true,"誘":true,"憂":true,"融":true,"優":true,"与":true,"予":true,"余":true,"誉":true,"預":true,"幼":true,"用":true,"羊":true,"妖":true,"洋":true,"要":true,"容":true,"庸":true,"揚":true,"揺":true,"葉":true,"陽":true,"溶":true,"腰":true,"様":true,"瘍":true,"踊":true,"窯":true,"養":true,"擁":true,"謡":true,"曜":true,"抑":true,"沃":true,"浴":true,"欲":true,"翌":true,"翼":true,"拉":true,"裸":true,"羅":true,"来":true,"雷":true,"頼":true,"絡":true,"落":true,"酪":true,"辣":true,"乱":true,"卵":true,"覧":true,"濫":true,"藍":true,"欄":true,"吏":true,"利":true,"里":true,"理":true,"痢":true,"裏":true,"履":true,"璃":true,"離":true,"陸":true,"立":true,"律":true,"慄":true,"略":true,"柳":true,"流":true,"留":true,"竜":true,"粒":true,"隆":true,"硫":true,"侶":true,"旅":true,"虜":true,"慮":true,"了":true,"両":true,"良":true,"料":true,"涼":true,"猟":true,"陵":true,"量":true,"僚":true,"領":true,"寮":true,"療":true,"瞭":true,"糧":true,"力":true,"緑":true,"林":true,"厘":true,"倫":true,"輪":true,"隣":true,"臨":true,"瑠":true,"涙":true,"累":true,"塁":true,"類":true,"令":true,"礼":true,"冷":true,"励":true,"戻":true,"例":true,"鈴":true,"零":true,"霊":true,"隷":true,"齢":true,"麗":true,"暦":true,"歴":true,"列":true,"劣":true,"烈":true,"裂":true,"恋":true,"連":true,"廉":true,"練":true,"錬":true,"呂":true,"炉":true,"賂":true,"路":true,"露":true,"老":true,"労":true,"弄":true,"郎":true,"朗":true,"浪":true,"廊":true,"楼":true,"漏":true,"籠":true,"六":true,"録":true,"麓":true,"論":true,"和":true,"話":true,"賄":true,"脇":true,"惑":true,"枠":true,"湾":true,"腕":true}



//This is the range for common Kanji. There are more, but it's highly unlikely we'd run into any
var KANJI_MAX = 0x9faf
var KANJI_MIN = 0x4e00

//kanji are mapped to ranges because chrome's total sync storage max is substantially > than its per item max
//Comments explain how the below were computed, but if they do change, changing the constants with them
//would break our storage. So the constants are constant for now. 
var STORAGE_ENTRIES = 25 //chrome.storage.sync.QUOTA_BYTES / chrome.storage.sync.QUOTA_BYTES_PER_ITEM
var HASH_RANGE = 837 //Math.floor((KANJI_MAX - KANJI_MIN) / STORAGE_ENTRIES)+1


// kanji are thrown into ranges based on the formula: Math.floor((kanji.charCodeAt(0) - KANJI_MIN)/HASH_RANGE)+1
//ceiling is out of the question because then the lowest value kanji tries to put itself in nonexistant range 0
//so we use floor+1, but unless we know our top range to exceed our max, a max value kanji could produce a 
//nonexistant range 26 by dividing exactly, producing floor(25)=25 and then +1 gives us 26. So floor+1 for HASH_RANGE
//ensures our top range is always slightly above max, although it usually is anyway. The top range will catch 
//slightly fewer kanji, but that's no real concern


//TODO: we don't need to save how many times it occured on page, but the information is valuable
//new kanji should probably be sorted like that, and there should at least be an option to sort other kanji like
//that (the alternative being sorting them by how many times you've seen them before)

//look into a better way to get only visible page text.
//Also, much better styling - links having HREFs is making them blue, and we should mark non-jouyou kanji



function saveSynced(kanjiHash)
{
  var syncHash = {}

  for (var i = 1; i <= STORAGE_ENTRIES; i++)
  {
    syncHash[''+i] = {}
  }

  for (var kanji in kanjiHash)
  {
    //have to use floor+1, or numbers that == the bottom of the range break it
    //this works, even for the highest and lowest kanji values (likely because our top range slightly
    //exceeds max so division for the highest number still produces a number <25)
    syncHash[''+(Math.floor((kanji.charCodeAt(0) - KANJI_MIN)/HASH_RANGE)+1)][kanji] = kanjiHash[kanji]
  }

  chrome.storage.sync.set(syncHash, function(){
    if (chrome.runtime.lastError)
    {
       error(chrome.runtime.lastError.message)
    }
  })

  return syncHash
}

function loadSynced(callback)
{
  var loadList = []
  for (var i = 1; i <= STORAGE_ENTRIES; i++)
  {
    loadList.push(''+i) //These have to be strings to work as keys for storage
  }
  chrome.storage.sync.get(loadList, function(loaded) //good to here; we load good data
  {
    if (chrome.runtime.lastError)
    {
       error(chrome.runtime.lastError.message)
       return
    }
    var syncHash = {}
    for (var i = 1; i <= STORAGE_ENTRIES; i++)
    {
      for (var item in loaded[i])
      {
        syncHash[item] = loaded[i][item]
      }
    }
    callback(syncHash)
  })

}

function pairLists(kanji)
{
  pairs = []
  newPairs = []
  for (var value in kanji)
  {
    if (kanji[value]==1) newPairs.push([value, kanji[value]])
    else pairs.push([value, kanji[value]])
  } 
  pairs.sort(function(a, b) 
  {
    a = a[1];
    b = b[1];
    return a < b ? -1 : (a > b ? 1 : 0);
  })
  return [newPairs, pairs]
}

//The values in the storage hash are page views and the ones in the generated hash are occurences on page, so they don't equate
//and consequently we don't sum them. We only look for instances of the kanji existing

function registerNewHash(pageHash, storageHash)
{
  for (var value in pageHash) //We look at keys here, because we don't care about how many times it occured on page (the values)
  {
    storageHash[value] = storageHash[value] ? storageHash[value]+1 : 1
  }

  saveSynced(storageHash)

  return storageHash
}


//Save the old hash, and have a "don't save results from this page" button for the purposes of reverting
var pageHash, storageHash, newHash
$(function () 
{
chrome.tabs.query({active: true, currentWindow: true}, function(tabs) 
{
    //Get the page hash in the form of {'Kanji':Occurence #}
    chrome.tabs.sendMessage(tabs[0].id, {method: "scrape"}, function(response)
    { //this is asynchronous, so we're ending up nesting like this to insure consecutiveness
        pageHash = response.data
        if (response.repeat)
        {
          loadSynced(function(loaded)
          {
              storageHash = loaded
              draw(storageHash, pageHash)
          })
        }
        else
        {
          loadSynced(function(loaded)
          {
              storageHash = loaded
              newHash = registerNewHash(pageHash, storageHash)
              draw(newHash, pageHash)
          })
        }


    });
    
  });
});

function draw(hash, pageHash)
{
  //[kanji, #seen]
  var div, appendString;
  var lists = pairLists(hash)
  var newPairs = lists[0]
  var pairs = lists[1]
  if (newPairs.length > 0)
  {
    div = $('#newKanji')
    div.show()
    for (var i = 0 ; i < newPairs.length; i ++)
    {
      pair = newPairs[i]
      if (pageHash[pair[0]])
      {
        appendString = '<a href="http://jisho.org/kanji/details/'+pair[0]+'" tooltip="'+pair[0]+' is new!" class="kanji">'+pair[0]+'</a>'
        if (pair != newPairs[pairs.length-1]) appendString += ", "
        div.append(appendString)
      }
    }
  }
  if (pairs.length > 0)
  {
    div = $('#kanji')
    div.show()
    for (var i = 0 ; i < pairs.length; i ++)
    {
      pair = pairs[i]
      if (pageHash[pair[0]])
      {
        appendString = '<a href="http://jisho.org/kanji/details/'+pair[0]+'" tooltip="'+pair[0]+' seen '+pair[1]+' times" class="kanji">'+pair[0]+'</a>'
        if (pair != pairs[pairs.length-1]) appendString += ", "
        div.append(appendString)
      }
    }
  }
  if (Object.keys(pageHash).length < 1)
  {
    div = $('#noKanji')
    div.show()
    div.append("No Kanji found on page :(")
  }
}

function error(errorText)
{
  $('#error').text(errorText)
}

function syncHashStructure() //demo function, no actual use
{
  var syncHash = {}
  for (var i = 1; i <= STORAGE_ENTRIES; i++)
  {
    syncHash[i] = ( KANJI_MIN+((i-1)*HASH_RANGE) )+"-"+( KANJI_MIN+(i*HASH_RANGE) )
  }
  return syncHash
}
